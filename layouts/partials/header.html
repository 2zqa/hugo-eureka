<nav class="flex items-center justify-between flex-wrap p-4">
    <div class="flex items-center flex-shrink-0 text-primary-text mr-6">
        <a href="/" class="font-semibold text-xl tracking-tight">{{ .Site.Title }}</a>
    </div>
    <div class="block md:hidden">
        <button id="navbar-btn" class="flex items-center px-3 py-2">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <div id="target" class="hidden block flex-grow md:flex md:items-center w-full md:w-auto text-primary-text z-20">
        <div class="text-sm md:flex-grow pb-4 md:pb-0 border-b md:border-b-0">
            {{ range .Site.Menus.main }}
            <a href="{{ .URL | relLangURL }}"
                class="block mt-4 md:inline-block md:mt-0 text-black hover:text-eureka mr-4 main-a">{{ .Name }}</a>
            {{ end }}
        </div>

        <div class="relative inline-block pt-4 md:pt-0">
            <div class=" relative cursor-pointer hover:text-eureka" id="lightDarkMode">
                <i class="fas fa-adjust"></i>
            </div>
            <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id="is-open">
            </div>
            <div class="absolute hidden left-0 md:left-auto right-auto md:right-0 bg-secondary-bg rounded py-2 border cursor-pointer z-40"
                id='lightDarkOptions'>
                <div class="pl-6 pr-16 py-1 hover:text-eureka">Light</div>
                <div class="pl-6 pr-16 py-1 hover:text-eureka">Dark</div>
                <div class="pl-6 pr-16 py-1 hover:text-eureka">Auto</div>
            </div>
        </div>

        {{ if .IsTranslated }}
        <div class="relative inline-block pt-4 md:pt-0">
            <div class=" relative pl-4 cursor-pointer hover:text-eureka" id="languageMode">
                <i class="fas fa-globe"></i>
                <text class="pl-1">en</text>
            </div>
            <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id="is-open-lang">
            </div>
            <div class="absolute hidden left-0 md:left-auto right-auto md:right-0 bg-secondary-bg rounded py-2 border cursor-pointer z-40"
                id='languageOptions'>
                {{ range .Translations }}
                <a class="block pl-6 pr-16 py-1 hover:text-eureka" href="{{ .Permalink }}">{{ .Lang }}</a>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>

    <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id="is-open-mobile">
    </div>

</nav>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        let element = document.getElementById('navbar-btn');
        let screen = document.getElementById('is-open-mobile');
        let target = document.getElementById('target');
        element.addEventListener('click', () => {

            target.classList.toggle('hidden');
            screen.classList.toggle('hidden')
        })
        screen.addEventListener('click', () => {
            target.classList.toggle('hidden')
            screen.classList.toggle('hidden')
        })
    });

    document.addEventListener('DOMContentLoaded', () => {
        let elements = document.getElementsByClassName('main-a');
        for (let i in elements) {
            if (elements[i].href == sessionStorage.getItem("mainKey")) {
                elements[i].classList.add('text-eureka')
            }
            elements[i].addEventListener('click', () => {
                sessionStorage.setItem("mainKey", elements[i].href);
            })
        }
    });

    document.addEventListener('DOMContentLoaded', () => {
        let element = document.getElementById('lightDarkMode');
        let targetdiv = document.getElementById('lightDarkOptions');
        let targets = targetdiv.getElementsByTagName('div')
        let screen = document.getElementById('is-open');
        let storagemode = localStorage.getItem("lightDarkMode")

        if (storagemode != null) {
            let old_icon = element.firstElementChild.getAttribute("data-icon")
            element.firstElementChild.setAttribute("data-icon", storagemode)
            element.firstElementChild.classList.remove('fa-' + old_icon)
            element.firstElementChild.classList.add('fa-' + storagemode)
        }

        element.addEventListener('click', () => {
            targetdiv.classList.toggle('hidden');
            screen.classList.toggle('hidden')
        })

        for (let target of targets) {
            target.addEventListener('click', () => {
                let icon = ''

                switch (target.innerHTML) {
                    case 'Light':
                        icon = 'sun'
                        break
                    case 'Dark':
                        icon = 'moon'
                        break
                    case 'Auto':
                        icon = 'adjust'
                        break
                }

                let old_icon = element.firstElementChild.getAttribute("data-icon")
                element.firstElementChild.setAttribute("data-icon", icon)
                element.firstElementChild.classList.remove('fa-' + old_icon)
                element.firstElementChild.classList.add('fa-' + icon)
                console.log(element.firstElementChild)

                localStorage.setItem("lightDarkMode", icon)

                targetdiv.classList.toggle('hidden')
                screen.classList.toggle('hidden')


            })
        }
        screen.addEventListener('click', () => {
            console.log('关闭')
            targetdiv.classList.toggle('hidden')
            screen.classList.toggle('hidden')
            console.log(screen)
        })


    })

    document.addEventListener('DOMContentLoaded', () => {
        let element = document.getElementById('languageMode');
        let targetdiv = document.getElementById('languageOptions');
        let targets = targetdiv.getElementsByTagName('a')
        let screen = document.getElementById('is-open-lang');
        let storagemode = localStorage.getItem("languageMode")

        if (storagemode != null) {
            console.log(element.getElementsByTagName('text')[0])
            element.getElementsByTagName('text')[0].innerHTML = storagemode
        }

        element.addEventListener('click', () => {
            targetdiv.classList.toggle('hidden');
            screen.classList.toggle('hidden')
        })

        for (let target of targets) {
            target.addEventListener('click', () => {
                localStorage.setItem("languageMode", target.innerHTML)
                targetdiv.classList.toggle('hidden')
                screen.classList.toggle('hidden')
            })
        }
        screen.addEventListener('click', () => {
            targetdiv.classList.toggle('hidden')
            screen.classList.toggle('hidden')
        })


    })

</script>